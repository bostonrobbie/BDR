# Safety & DRY RUN Mode

## Overview

The Outreach Command Center operates with safety as a first-class concern. The system is designed to generate drafts, research, and plans — never to send outbound messages or take irreversible actions automatically.

## DRY RUN Mode

### What It Is
DRY_RUN is a global safety flag that is **always ON by default**. When active, the system blocks all outbound actions and restricts outputs to safe categories only.

### How It Works
- A global `DRY_RUN = True` flag is set at application startup
- The `check_safety(action)` function is called before any potentially outbound operation
- Blocked actions: `send_linkedin_message`, `send_email`, `connect_request`, `post_comment`, `send_inmail`
- If a blocked action is attempted, a `safety_events` record is created and the action is rejected

### Visibility
- The DRY RUN badge is displayed at the top of the LinkedIn Channel page
- The badge is always visible during workflow execution
- The system status endpoint (`GET /api/system/dry-run`) returns the current flag state

### What DRY RUN Allows
- Generating message drafts (stored in `message_drafts` table)
- Running account research (stored in `research_snapshots`)
- Building prospect shortlists
- Creating daily plans
- Importing LinkedIn profiles (CSV or manual paste)
- Logging all activity to `activity_timeline`
- Exporting data

### What DRY RUN Blocks
- Sending LinkedIn InMails
- Sending connection requests
- Sending emails
- Posting comments on LinkedIn
- Any action that contacts a prospect directly

## Safety Events

Every blocked action is logged in the `safety_events` table:

| Field | Description |
|-------|-------------|
| id | Unique event ID |
| event_type | The action that was blocked |
| action_blocked | Description of what was prevented |
| reason | Why it was blocked (e.g., "DRY_RUN active") |
| metadata | JSON with additional context |
| created_at | Timestamp |

View safety events via: `GET /api/safety-events`

## Workflow Safety

All 7 workflows enforce safety:
1. **Account Research** — Read-only research, no outbound contact
2. **Prospect Shortlist** — Scoring and ranking only, no actions taken
3. **LinkedIn Message Drafts** — Generates drafts with `status=draft`, never sends
4. **Follow-Up Sequence** — Plans touches, stores as drafts
5. **Daily Plan** — Creates a schedule, does not execute it
6. **Email Drafts** — Generates drafts, never sends
7. **Call Prep** — Generates call scripts, Rob makes calls manually

## Draft Lifecycle

All generated messages follow this lifecycle:
1. `draft` — Generated by workflow, pending review
2. `approved` — Reviewed and approved in Approval Queue
3. `sent` — Manually sent by Rob (status updated by Rob)
4. `rejected` — Rejected during review

The system never moves a draft past `draft` status automatically. Rob controls all progression.

## Audit Trail

Every action in the system is logged:
- `workflow_runs` — Records every workflow execution with status
- `workflow_run_steps` — Records each step within a workflow run
- `activity_timeline` — Global activity log across all channels
- `safety_events` — Specifically tracks blocked outbound actions
- `agent_runs` — Agent execution history

## API Endpoints

| Endpoint | Method | Description |
|----------|--------|-------------|
| /api/system/dry-run | GET | Current DRY_RUN status |
| /api/safety-events | GET | List all safety events |
| /api/activity | GET | Full activity timeline |
| /api/workflow-runs | GET | All workflow executions |
| /api/workflow-runs/{id}/steps | GET | Steps for a specific run |

## Design Principles

1. **Default safe** — DRY_RUN is ON at startup, not something you enable
2. **Allowlist, not blocklist** — Only explicitly safe outputs are permitted
3. **Audit everything** — Every action, blocked or allowed, is logged
4. **Human in the loop** — Rob reviews all drafts and executes all outbound manually
5. **No credential storage** — No LinkedIn passwords, no email credentials stored
6. **No scraping** — LinkedIn data is imported via CSV or manual paste, not scraped
